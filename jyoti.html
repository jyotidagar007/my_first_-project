<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
    </script>
    <title>To-Do List</title>
    <style>
        .Outer {
            display: none;
            padding-top: 2px;
            padding-bottom: 2px;
            text-align: right;
        }

        table,
        td,
        th {
            border: 1px solid black;
            border-collapse: collapse;
            text-align: center;
            padding: 13px;

        }

        .todo {
            text-align: center;
            font-size: large;
            color: mediumblue;
            display: none;
        }

        .fixed {
            position: fixed;
            bottom: 3%;
            right: 10%;
            border: 2px outset #20899b1e;
            padding: 0.5%;
            padding-right: 1%;
            padding-left: 1%;
            background-color: hsla(202, 38%, 40%, 0.178);
            border-radius: 2cm;

        }

        #left {
            position: fixed;
            left: 5%;
            margin-top: 7%;
        }

        #right {
            position: fixed;
            right: 10%;
        }

        #Priority {
            padding: 2%;
            background-color: rgba(81, 131, 160, 0.425);
            border-radius: 2cm;
            color: black;
            border: hidden
        }
    </style>
</head>

<body style="background-image: url(background.jpg);">

    <div id="left" class="todo">

        <form autocomplete="off">
            <b><label for="task" style="font-style: italic; font-size:x-large; font-style: italic; border:hidden; background-color: hsla(203, 16%, 71%, 0.425);
padding: 4%; padding-top: 3%; padding-bottom: 3%; border-radius: 2cm; color: rgb(102, 4, 4);">Enter New
                    Task:</label></b><br><br><br>
            <input style="background:hsla(202, 52%, 70%, 0.425); height:1cm; font-size: medium;" type="text" id="task"
                name="task" placeholder="Title..." value="" /><br><br>
            <textarea id="desc" cols="30" rows="5" style="background:hsla(202, 52%, 70%, 0.425); font-size: medium;"
                placeholder="DESCRIPTION..." value=""></textarea><br><br>
            <input style="background:hsla(202, 52%, 70%, 0.425); height:1cm; font-size: medium;" type="text" id="tag"
                name="tag" placeholder="Tags..." value=""><br><br>

            <select id="Priority" name="Priority" value="">
                <option id="CV" value="CHOOSE PRIORITY ">CHOOSE PRIORITY </option>
                <option id="high" value="high" name="priority">HIGH</option>
                <option id="mid" value="mid" name="priority">MID</option>
                <option id="low" value="low" name="priority">LOW</option>
            </select><br><br>

            <input id="row_i_d" name="row_i_d" value="" hidden />

            <button id="add" onclick="todo()" style="background:powderblue;">ADD</button>
        </form>

    </div>

    <div id="right" class="todo">

        <div class="Outer">
            <h1 style=" font-family: Georgia, 'Times New Roman', Times, serif; text-align:center; color: navy;">TO-DO
                LIST
            </h1>
        </div>

        <table id="myTable" style="margin: auto;">
            <tr>
                <b>
                    <th style="background-color: hsla(202, 38%, 40%, 0.425); font-family: sans-serif; width : 1cm;">S.No
                    </th>
                    <th style="background-color: hsl(202, 38%, 40%, 0.425); font-family: sans-serif; width:2.5cm;">Time
                    </th>
                    <th style="background-color: hsl(202, 38%, 40%, 0.425); font-family: sans-serif; width:2.5cm;">TASK
                    </th>
                    <th style="background-color: hsl(202, 38%, 40%, 0.425); font-family: sans-serif; width:2.5cm;">
                        DESCRIPTION</th>
                    <th style="background-color: hsl(202, 38%, 40%, 0.425); font-family: sans-serif; width:2.5cm;">TAG
                    </th>
                    <th style="background-color: hsl(202, 38%, 40%, 0.425); font-family: sans-serif; width:2.5cm;"
                        colspan="3">ACTION</th>
            </tr>
        </table><br>

        <p class="fixed" style="display: none; font-style: italic; color: rgb(2, 2, 2); ">NEW TASK IS ADDED</p>

        <button style="text-align: end; background: powderblue;" onclick="clearAll()">Clear All</button>

    </div>


    <script>

        // var username = sessionStorage.getItem("username");

        $(document).ready(function () {
            $(".Outer").fadeIn(2000);
        });
        $(document).ready(function () {
            $(".todo").fadeIn(3000);
        });

        var i = 0;

        var table = document.getElementById("myTable");

        let obj_td = JSON.parse(localStorage.getItem("to_do_"));

        if (obj_td) {
            let r_n = obj_td.username;

            for (let key in r_n) {
                i += 1;
            }
            let s_no = 0;
            for (let key in r_n) {
                if (r_n.hasOwnProperty(key)) {
                    let res = {};
                    res = r_n[key];
                    var prio = res.col;
                    s_no = s_no + 1;
                    let row = table.insertRow(s_no);
                    row.insertCell(0).innerHTML = s_no;
                    row.insertCell(1).innerHTML = res.date;
                    row.insertCell(2).innerHTML = res.text;
                    row.insertCell(3).innerHTML = res.desc;
                    row.insertCell(4).innerHTML = res.tag;

                    var ch1 = "<button onclick='removeTask(this)'>Delete</button> ";
                    var ch2 = "<button onclick='edit(this)'>Edit</button> ";
                    var ch = ch1.concat(ch2);
                    var ch3;

                    if (res.complete) {
                        row.style.backgroundColor = "rgb(170, 181, 173)";

                        let ch4 = "<button onclick='rem_highlight_row(this)'>Undo</button>";
                        ch3 = ch.concat(ch4);

                    }
                    else {

                        row.style.backgroundColor = "unset";

                        let ch4 = "<button onclick='highlight_row(this)'>Complete</button>";
                        ch3 = ch.concat(ch4);

                        if (prio == "RED") {
                            row.style.backgroundColor = "rgb(255, 199, 216)";

                        } else if (prio == "YELLOW") {
                            row.style.backgroundColor = "rgb(238, 240, 141)";

                        } else if (prio == "GREEN") {
                            row.style.backgroundColor = "rgb(171, 245, 171)";
                        }
                    }

                    row.insertCell(5).innerHTML = ch3;
                }

            }
        }

        var username = {};
        let row_no = {};

        function todo() {
            if (task.value == "") {
                alert("Please enter value");
                return;
            }

            else {
                let data = {};

                let row_id = document.getElementById("row_i_d").value;

                var newT = document.getElementById("task").value;

                var d = new Date();
                var m = d.getDate() + "-" + d.getMonth() + "-" + d.getFullYear() + " " + d.getHours() + ":" + d.getMinutes();


                var desc = document.getElementById("desc").value;
                var tag = document.getElementById("tag").value;
                var prio = document.getElementById("Priority").value;

                document.getElementById("task").value = '';
                document.getElementById("desc").value = '';
                document.getElementById("tag").value = '';
                document.getElementById("row_i_d").value = '';
                document.getElementById("Priority").value = "CHOOSE PRIORITY ";

                data.date = m;
                data.text = newT;
                data.desc = desc;
                data.tag = tag;
                data.complete = false;
                data.col = "no_colour";

                if (row_id && row_id != "") {
                    console.log("bye");

                    let row = table.getElementsByTagName('tr')[row_id];

                    row.cells[1].innerHTML = m;
                    row.cells[2].innerHTML = newT;
                    row.cells[3].innerHTML = desc;
                    row.cells[4].innerHTML = tag;

                    if (prio == "high") {
                        row.style.backgroundColor = "rgb(255, 199, 216)";
                        data.col = "RED";

                    } else if (prio == "mid") {
                        row.style.backgroundColor = "rgb(238, 240, 141)";
                        data.col = "YELLOW";

                    } else if (prio == "low") {
                        row.style.backgroundColor = "rgb(171, 245, 171)";
                        data.col = "GREEN";
                    }

                    main_localStor(data, row_id);

                }
                else {

                    i = i + 1;

                    $("p").fadeIn(1000);
                    $("p").fadeOut(1000);

                    var row = table.insertRow(i);

                    row.id = i;
                    row.insertCell(0).innerHTML = i;
                    row.insertCell(1).innerHTML = m;
                    row.insertCell(2).innerHTML = newT;
                    row.insertCell(3).innerHTML = desc;
                    row.insertCell(4).innerHTML = tag;
                    row.insertCell(5).innerHTML = "<button onclick='removeTask(this)'>Delete</button> <button onclick='edit(this)'>Edit</button> <button onclick='highlight_row(this)'>Complete</button>";

                    if (prio == "high") {
                        row.style.backgroundColor = "rgb(255, 199, 216)";
                        data.col = "RED";

                    } else if (prio == "mid") {
                        row.style.backgroundColor = "rgb(238, 240, 141)";
                        data.col = "YELLOW";

                    } else if (prio == "low") {
                        row.style.backgroundColor = "rgb(171, 245, 171)";
                        data.col = "GREEN";
                    }

                    main_localStor(data, i);

                }

                document.addEventListener('submit', (event) => {
                    event.preventDefault();
                })



            }
        }

        function main_localStor(row_data, num) {

            row_no["row_no" + num] = row_data;
            username["username"] = row_no;
            localStorage.setItem("to_do_", JSON.stringify(username));
        }

        function get_data(row_num) {
            let obj = JSON.parse(localStorage.getItem("to_do_"));
            let rown = obj.username;
            let data = {};
            let count = 0;

            for (let key in rown) {
                count += 1;
                if (rown.hasOwnProperty(key)) {
                    data = rown[key];
                    if (row_num == count) {
                        break;
                    }
                }
            }

            return data;
        }

        function edit(rowdata) {
            let num = rowdata.parentNode.parentNode.rowIndex;

            let data = {};
            data = get_data(num);

            $("#task").val(data.text);
            $("#row_i_d").val(num);
            $("#desc").val(data.desc);
            $("#tag").val(data.tag);

        }

        function highlight_row(element) {

            var num = element.parentNode.parentNode.rowIndex;

            var rowSelected = table.getElementsByTagName('tr')[num];

            rowSelected.style.backgroundColor = "rgb(170, 181, 173)";

            rowSelected.deleteCell(5);
            rowSelected.insertCell(5).innerHTML = "<button onclick='removeTask(this)'>Delete</button> <button onclick='edit(this)'>Edit</button> <button onclick='rem_highlight_row(this)'>Undo</button>";

            let data = {};
            let obj_del = JSON.parse(localStorage.getItem("to_do_"));

            let row_n = obj_del.username;

            data = row_n["row_no" + num];
            data.complete = true;
            row_n["row_no" + num] = data;

            obj_del.username = row_n;
            localStorage.setItem("to_do_", JSON.stringify(obj_del));

        }

        function rem_highlight_row(element) {
            var key = element.parentNode.parentNode.rowIndex;

            var rowSelected = table.getElementsByTagName('tr')[key];

            rowSelected.style.backgroundColor = "unset";

            rowSelected.deleteCell(5);
            rowSelected.insertCell(5).innerHTML = "<button onclick='removeTask(this)'>Delete</button> <button onclick='edit(this)'>Edit</button> <button onclick='highlight_row(this)'>Complete</button>";

            let data = {};
            let obj_del = JSON.parse(localStorage.getItem("to_do_"));

            let row_n = obj_del.username;

            data = row_n["row_no" + key];
            data.complete = false;
            row_n["row_no" + key] = data;
            var pri = data.col;

            obj_del.username = row_n;
            localStorage.setItem("to_do_", JSON.stringify(obj_del));
     

            if (pri == "RED") {
                rowSelected.style.backgroundColor = "rgb(255, 199, 216)";
            }

            else if (pri == "YELLOW") {
                rowSelected.style.backgroundColor = "rgb(238, 240, 141)";
            }

            else if (pri == "GREEN") {
                rowSelected.style.backgroundColor = "rgb(171, 245, 171)";
            }

        }

        function removeTask(element) {

            var key = element.parentNode.parentNode.rowIndex;

            table.deleteRow(key);

            let obj_del = JSON.parse(localStorage.getItem("to_do_"));

            let row_n = obj_del.username;

            row_n["row_no" + key] = undefined;
            obj_del.username = row_n;
            localStorage.setItem("to_do_", JSON.stringify(obj_del));

            i--;

        }

        function clearAll() {

            var r = confirm("Are you sure you want to clear the list?");

            if (r == true) {

                var Rows = table.getElementsByTagName('tr');
                var len = Rows.length;

                for (let p = len; p > 1; p--) {
                    table.deleteRow(-1);
                    i = i - 1;
                }

                let obj_del = JSON.parse(localStorage.getItem("to_do_"));

                obj_del["username"] = undefined;

                localStorage.setItem("to_do_", JSON.stringify(obj_del));


            }
            else {
                return;
            }
        }

    </script>

</body>

</html>